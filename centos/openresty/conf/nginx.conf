worker_processes  1;        #auto, nginx worker 数量
error_log logs/error.log;   #指定错误日志文件路径
events {
    worker_connections 1024;
}

# for docker link to redis
# env | grep REDIS
env REDIS_PORT_6379_TCP_ADDR;
env REDIS_PORT_6379_TCP_PORT;

http {

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  logs/access.log  main;

    include                 mime.types;
    include                 gzip.conf;

    charset                 utf-8;
    sendfile                on;
    keepalive_timeout       10;
    resolver                127.0.0.1;

    # 注意一定在生产环境开启
    lua_code_cache          off;
    lua_socket_log_errors   off;
    lua_check_client_abort  on;
    lua_package_path        '${prefix}site/?.lua;${prefix}libs/?.lua;;';
    lua_package_cpath       '${prefix}libs/?.so;;';
    send_timeout            15s;
    
    # for 
    # A lua_shared_dict named cache_ngx is required by test:bench_run
    lua_shared_dict cache_ngx 100k;

    init_by_lua_file        'site/init.lua';
    
    #init_worker_by_lua_block {
    #    local syncr_config = require "ddtk.syncr_config"
    #    syncr_config.sync_init()
    #}

    proxy_cache_path cache levels=1:2 keys_zone=my_cache:10m max_size=100m inactive=60m
    use_temp_path=off;
    
    server {
        listen 6699;

        include             settings.conf;
        include             locations.conf;

    }

    server {
        listen 18081;

        index index.html;
        root /Users/yangjiandong/workspace/ssh/jekyll/web;
    } 
}
